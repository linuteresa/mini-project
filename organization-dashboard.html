<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>GoodWill</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Kaushan+Script&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat+Alternates&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap">
    <link rel="stylesheet" href="assets/css/dh-header-non-rectangular.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="assets/css/Navbar-Right-Links.css">
    <link rel="stylesheet" href="assets/css/News-Cards.css">
    <link rel="stylesheet" href="assets/css/org-style.css">
</head>


<!-- ----------------------------Start of page body------------------------------- -->

<body>
    <div>
        <nav class="navbar navbar-light navbar-expand-md py-3">
            <div class="container">
                <a class="navbar-brand d-flex align-items-center" href="#">
                    <img class="img-fluid image1" src="assets/img/logo-removebg-preview.png">
                </a>
                <div class="collapse navbar-collapse" id="navcol-2">
                    <ul class="navbar-nav ms-auto">
                        <a class="me-4" href="#tableclothes">
                            <li class="nav-item">Clothes</li>
                        </a>
                        <a class="me-4" href="#tablefood">
                            <li class="nav-item">Food</li>
                        </a>
                    </ul>
                    <a class="btn btn-primary ms-md-2 logout" role="button" href="index.html">LOGOUT</a>
                </div>
            </div>
        </nav>
    </div>

    <div class="container m-5">
        <h4 class="mb-3">Welcome</h4>
        <h1 class="mb-3" id="orgname"></h1>
    </div>


    <!- -------------------- Food Modal ------------------- -->
        <div class="modal1" id="foodModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Food Details</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <table>
                        <tr>
                            <td>Type:</td>
                            <td id="ftype" class="ps-3"></td>
                        </tr>
                        <tr>
                            <td>Item:</td>
                            <td id="fitem" class="ps-3"></td>
                        </tr>
                        <tr>
                            <td>Quantity:</td>
                            <td id="fquantity" class="ps-3"></td>
                        </tr>
                        <tr>
                            <td>Manufactured date:</td>
                            <td id="fmand" class="ps-3"></td>
                        </tr>
                        <tr>
                            <td>Manufactured time:</td>
                            <td id="fmant" class="ps-3"></td>
                        </tr>
                        <tr>
                            <td>Expiry Date:</td>
                            <td id="fexpd" class="ps-3"></td>
                        </tr>
                        <tr>
                            <td>Expiry Time:</td>
                            <td id="fexpt" class="ps-3"></td>
                        </tr>
                        <tr>
                            <td>Name of donor:</td>
                            <td id="fname" class="ps-3"></td>
                        </tr>
                        <tr>
                            <td>Contact number:</td>
                            <td><a href="tel: #" id="fphone" class="ps-3"></a></td>
                        </tr>
                        <tr>
                            <td>Address:</td>
                            <td id="faddr" class="ps-3"></td>
                        </tr>
                        <tr>
                            <td>Pin code:</td>
                            <td id="fpin" class="ps-3"></td>
                        </tr>
                    </table>


                </div>
                <div class="modal-footer">
                    <div class="row">
                        <div class="col-md-7">
                            <p class="text-danger footer-text">Please delete the data only after confirming with the
                                donor
                            </p>
                        </div>
                        <div class="col-md-3">
                            <button type="button" class="btn btn-danger" id="faccept" data-dismiss="modal">Accept and
                                Delete
                                Data</button>
                        </div>
                    </div>


                </div>
            </div>
        </div>


        <!- ------------------ Cloth Modal ------------------------- -->

            <div class="modal1" id="clothModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Cloth Details</h5>
                        <button type="button" class="cclose" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <table>
                            <tr>
                                <td>Gender:</td>
                                <td id="cgend" class="ps-3"></td>
                            </tr>
                            <tr>
                                <td>Item:</td>
                                <td id="citem" class="ps-3"></td>
                            </tr>
                            <tr>
                                <td>Quantity:</td>
                                <td id="cquantity" class="ps-3"></td>
                            </tr>
                            <tr>
                                <td>Size: </td>
                                <td id="csize" class="ps-3"></td>
                            </tr>
                            <tr>
                                <td>Name of donor:</td>
                                <td id="cname" class="ps-3"></td>
                            </tr>
                            <tr>
                                <td>Contact number:</td>
                                <td><a href="tel: #" id="cphone" class="ps-3"></a></td>
                            </tr>
                            <tr>
                                <td>Address:</td>
                                <td id="caddr" class="ps-3"></td>
                            </tr>
                            <tr>
                                <td>Pin code:</td>
                                <td id="cpin" class="ps-3"></td>
                            </tr>

                        </table>
                    </div>
                    <div class="modal-footer">
                        <div class="row">
                            <div class="col-md-7">
                                <p class="text-danger footer-text">Please delete the data only after confirming with the
                                    donor
                                </p>
                            </div>
                            <div class="col-md-3">
                                <button type="button" class="btn btn-danger" id="caccept" data-dismiss="modal">Accept
                                    and Delete
                                    Data</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ----------------------------------------------------------------------- -->

            <div class="container">
                <div class="row">

                    <!-- ------------------------Food Table----------------------------------- -->
                    <div class="col-md-12 tble" id="tablefood">
                        <h1 class="m-4 subhead">Food items listed near you</h1>

                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Sl.No</th>
                                        <th>Food Item</th>
                                        <th>Quantity</th>
                                        <th>Manufacturing date</th>
                                        <th>Expiry date</th>
                                        <!-- <th>Status</th> -->
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="foodtbody"></tbody>
                            </table>
                        </div>
                    </div>

                    <script type="module">

                        var slno = 0;
                        var tbody = document.getElementById('foodtbody');



                        function AddItemToTable(type, fooditem, quantity, mfgdate, mfgtime, expdate, exptime, name, contact, address, pin, key, status) {
                            let trow = document.createElement('tr');

                            let td1 = document.createElement('td');
                            let td3 = document.createElement('td');
                            let td4 = document.createElement('td');
                            let td5 = document.createElement('td');
                            let td6 = document.createElement('td');
                            /// let td66 = document.createElement('td');
                            let td7 = document.createElement('td');

                            //---- For Modal --------
                            let m1 = document.getElementById("ftype");
                            let m2 = document.getElementById("fitem");
                            let m3 = document.getElementById("fquantity");
                            let m4 = document.getElementById("fmand");
                            let m5 = document.getElementById("fmant");
                            let m6 = document.getElementById("fexpd");
                            let m7 = document.getElementById("fexpt");
                            let m8 = document.getElementById("fname");
                            let m9 = document.getElementById("fphone");
                            let m10 = document.getElementById("faddr");
                            let m11 = document.getElementById("fpin");

                            var mykey = key;

                            

                            td1.innerHTML = ++slno;
                            td3.innerHTML = fooditem;
                            td4.innerHTML = quantity;
                            td5.innerHTML = mfgdate;
                            td6.innerHTML = expdate;
                            // td66.innerHTML = "<b><i>" + status + "</i></b>";
                            td7.innerHTML = "<button class=\"btn btn-primary idHere\">View details</button>";

                            trow.appendChild(td1);
                            trow.appendChild(td3);
                            trow.appendChild(td4);
                            trow.appendChild(td5);
                            trow.appendChild(td6);
                            // trow.appendChild(td66);
                            trow.appendChild(td7);
                            /*
                            if (status == "available") {
                                trow.appendChild(td7);
                            }
                            */

                            tbody.appendChild(trow);

                            //---- Adding Button -----
                            td7.addEventListener("click", function () {
                                console.log("Current key is " + mykey);
                                var modal = document.getElementById("foodModal");
                                var span = document.getElementsByClassName("close")[0];
                                var dlt = document.getElementById("faccept");

                                modal.style.display = "block";

                                span.onclick = function () {
                                    modal.style.display = "none";
                                }

                                /*  UPDATE FUNCTION 
                                faccept.onclick = async function () {
        
                                    const res = await firebase.database().ref('food/' + mykey).update({
                                        status: "unavailable"
                                    })
                                    console.log("res = " + res)
        
                                    modal.style.display = "none";
                                    location.reload();
                                }
                                */

                                
                                // DELETE FUNCTION
                                faccept.onclick = function deletedata() {
                                    firebase.database().ref('food/' + mykey).remove().then(() => {
                                        modal.style.display = "none";
                                        location.reload();
                                        alert("Deleted");
                                    }).catch((error) => {
                                        console.error("Error removing document: ", error);
                                    });
                                }

                                

                                // ---Deleting expired items---
                                var ex = exptime;
                                var tod = new Date();
                                // var todTime = tod.toLocaleTimeString();
                                function formatDate(date) {
                                    var d = new Date(date),
                                        month = '' + (d.getMonth() + 1),
                                        day = '' + d.getDate(),
                                        year = d.getFullYear();

                                    if (month.length < 2)
                                        month = '0' + month;
                                    if (day.length < 2)
                                        day = '0' + day;

                                    return [year, month, day].join('-');
                                }

                                var todDate = formatDate(tod);

                                function checkTime(i) {
                                    if (i < 10) {
                                        i = "0" + i;
                                    }
                                    return i;
                                }

                                var h = tod.getHours();
                                var m = tod.getMinutes();

                                // add a zero in front of numbers<10
                                m = checkTime(m);

                                var todTime = h + ":" + m;
                                var comp = exptime.localeCompare(todTime);

                                if (expdate < todDate && comp == '-1') {   // && exptime < todTime
                                    console.log("Delete data");
                                    // -- deleting expired data --
                                    firebase.database().ref('food/' + mykey).remove().then(() => {
                                        console.log("Expired item deleted")
                                        // location.reload();
                                        // alert("Deleted");
                                    }).catch((error) => {
                                        console.error("Error removing document: ", error);
                                    });
                                }
                                else {
                                    console.log("Donot delete");
                                }


                                //----- For Food modal --------
                                m1.innerHTML = type;
                                m2.innerHTML = fooditem;
                                m3.innerHTML = quantity;
                                m4.innerHTML = mfgdate;
                                m5.innerHTML = mfgtime;
                                m6.innerHTML = expdate;
                                m7.innerHTML = exptime;
                                m8.innerHTML = name;
                                m9.innerHTML = contact;
                                m10.innerHTML = address;
                                m11.innerHTML = pin;

                            });

                        }


                        function AddAllItemsToTable(Food) {
                            slno = 0;
                            tbody.innerHTML = "";
                            Food.forEach(element => {
                                AddItemToTable(element.type, element.fooditem, element.quantity, element.mfgdate, element.mfgtime, element.expdate, element.exptime, element.name, element.contact, element.address, element.pin, element.key, element.status);
                            });
                        }


                        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.0/firebase-app.js";


                        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
                        const firebaseConfig = {
                            apiKey: "AIzaSyD_INXx7IpF9b_zy-tWoVRmfV6Zg4YUge4",
                            authDomain: "goodwill-new.firebaseapp.com",
                            databaseURL: "https://goodwill-new-default-rtdb.firebaseio.com",
                            projectId: "goodwill-new",
                            storageBucket: "goodwill-new.appspot.com",
                            messagingSenderId: "604955362561",
                            appId: "1:604955362561:web:30c1a6adad63d8ae0c4700",
                            measurementId: "G-KR9X6Y49CT"
                        };
                        // Initialize Firebase
                        const app = initializeApp(firebaseConfig);

                        import { getDatabase, ref, child, onValue, get }
                            from "https://www.gstatic.com/firebasejs/9.9.0/firebase-database.js";

                        const db = getDatabase();

                        function GetAllDataOnce() {
                            const dbRef = ref(db);
                            get(child(dbRef, "food"))
                                .then((snapshot) => {
                                    var food = [];

                                    snapshot.forEach(childSnapshot => {
                                        food.push(childSnapshot.val());
                                    });

                                    AddAllItemsToTable(food);
                                });
                        }

                        window.onload = GetAllDataOnce;

                    </script>


                    <!---------------------Clothes Table------------------------------------------>

                    <div class="mt-5 mb-5 col-md-12 tble" id="tableclothes">
                        <h1 class="m-4 subhead">Clothes listed near you</h1>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Sl.No</th>
                                        <th>Item</th>
                                        <th>Gender</th>
                                        <th>Quantity</th>
                                        <th>Size</th>
                                        <!-- <th>Status</th> -->
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="clothtbody"></tbody>
                            </table>
                        </div>
                    </div>


                    <script type="module">
                        var sllno = 0;
                        var ttbody = document.getElementById('clothtbody');

                        function AddItemToclothTable(gender, clothitem, quantity, size, name, contact, address, pin, key, status) {
                            let ttrow = document.createElement('tr');

                            let ttd1 = document.createElement('td');
                            let ttd2 = document.createElement('td');
                            let ttd3 = document.createElement('td');
                            let ttd4 = document.createElement('td');
                            let ttd5 = document.createElement('td');
                            // let ttd6 = document.createElement('td');
                            let td7 = document.createElement('td');

                            //---- For Modal --------
                            let m1 = document.getElementById("cgend");
                            let m2 = document.getElementById("citem");
                            let m3 = document.getElementById("cquantity");
                            let m4 = document.getElementById("csize");
                            let m5 = document.getElementById("cname");
                            let m6 = document.getElementById("cphone");
                            let m7 = document.getElementById("caddr");
                            let m8 = document.getElementById("cpin");


                            ttd1.innerHTML = ++sllno;
                            ttd2.innerHTML = gender;
                            ttd3.innerHTML = clothitem;
                            ttd4.innerHTML = quantity;
                            ttd5.innerHTML = size;
                            // ttd6.innerHTML = "<b><i>" + status + "</i></b>";
                            td7.innerHTML = "<button class=\"btn btn-primary\">View details</button>";

                            var cmykey = key;

                            ttrow.appendChild(ttd1);
                            ttrow.appendChild(ttd3);
                            ttrow.appendChild(ttd2);
                            ttrow.appendChild(ttd4);
                            ttrow.appendChild(ttd5);
                            //  ttrow.appendChild(ttd6);
                            ttrow.appendChild(td7);
                            /*
                            if (status == "available") {
                                ttrow.appendChild(td7);
                            }
                            */

                            ttbody.appendChild(ttrow);

                            td7.addEventListener("click", function () {

                                var modal = document.getElementById("clothModal");
                                var span = document.getElementsByClassName("cclose")[0];
                                var dlt = document.getElementById("caccpet");

                                modal.style.display = "block";

                                span.onclick = function () {
                                    modal.style.display = "none";
                                }

                                caccept.onclick = function () {

                                    firebase.database().ref('clothes/' + cmykey).remove().then(() => {
                                        modal.style.display = "none";
                                        location.reload();
                                        alert("Deleted");
                                    }).catch((error) => {
                                        console.error("Error removing document: ", error);
                                    });


                                }

                                //----- For modal --------
                                m1.innerHTML = gender;
                                m2.innerHTML = clothitem;
                                m3.innerHTML = quantity;
                                m4.innerHTML = size;
                                m5.innerHTML = name;
                                m6.innerHTML = contact;
                                m7.innerHTML = address;
                                m8.innerHTML = pin;

                            });

                        }

                        function AddAllItemsToclothTable(cloth) {
                            sllno = 0;
                            ttbody.innerHTML = "";
                            cloth.forEach(element => {
                                AddItemToclothTable(element.gender, element.clothitem, element.quantity, element.size, element.name, element.contact, element.address, element.pin, element.key, element.status);
                            });
                        }

                        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.0/firebase-app.js";

                        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
                        const firebaseConfig1 = {
                            apiKey: "AIzaSyD_INXx7IpF9b_zy-tWoVRmfV6Zg4YUge4",
                            authDomain: "goodwill-new.firebaseapp.com",
                            databaseURL: "https://goodwill-new-default-rtdb.firebaseio.com",
                            projectId: "goodwill-new",
                            storageBucket: "goodwill-new.appspot.com",
                            messagingSenderId: "604955362561",
                            appId: "1:604955362561:web:30c1a6adad63d8ae0c4700",
                            measurementId: "G-KR9X6Y49CT"
                        };
                        const capp = initializeApp(firebaseConfig1);

                        import { getDatabase, ref, child, onValue, get }
                            from "https://www.gstatic.com/firebasejs/9.9.0/firebase-database.js";

                        const cdb = getDatabase();


                        function GetAllclothDataOnce() {
                            const dbRef = ref(cdb);

                            get(child(dbRef, "clothes"))
                                .then((snapshot) => {
                                    var clothes = [];

                                    snapshot.forEach(childSnapshot => {
                                        clothes.push(childSnapshot.val());
                                    });

                                    AddAllItemsToclothTable(clothes);
                                });
                        }

                        function addLoadEvent(func) {
                            var oldonload = window.onload;
                            if (typeof window.onload != 'function') {
                                window.onload = func;
                            } else {
                                window.onload = function () {
                                    if (oldonload) {
                                        oldonload();
                                    }
                                    func();
                                }
                            }
                        }
                        addLoadEvent(GetAllclothDataOnce);

                    </script>

                </div>

                <!-- -------------------Script Codes---------------------------------------- -->
                <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
                <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
                <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

                <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
                    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
                    crossorigin="anonymous"></script>
                <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
                    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
                    crossorigin="anonymous"></script>
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
                    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
                    crossorigin="anonymous"></script>

                <script src="assets/bootstrap/js/bootstrap.min.js"></script>
                <script src="assets/js/bs-init.js"></script>
                <script src="org-dash.js"></script>

</body>

</html>